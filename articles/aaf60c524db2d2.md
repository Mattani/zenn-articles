---
title: "Redmine ログイン失敗を繰り返すとアカウントをロックアウトにする機能について"
emoji: "💬"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [Redmine, plugin]
published: true
---

## はじめに

この記事は、[Redmine Advent Calendar 2025](https://adventar.org/calendars/11694)の12/22の記事として公開いたします。前回につづき、１日遅れすみません😅

会社のセキュリティガイドラインで、「ログイン失敗を複数回繰り返すとアカウントロックするしくみを有すること」という項目があり、Redmineの標準ではそんな機能ないなーとおもって調査していたところ、Redmine Login Attempts Limit のプラグインを見つけましたので紹介いたします。

なお、ちょうどこの調査をしていたところ、taikiiさんにより、[Redmine ログイン失敗でユーザをロックするプラグイン作った話](https://nagarage.dev/posts/2025/12/18_redmine-user-lockout-plugin/)という記事が紹介され、私のニーズに非常に近いのでは、とおもったのですが、残念ながらtaikiiさんのプラグインでは期待の動作になりませんでした。理由は後述します。

このプラグインは、midnightSuyama版がオリジナルで、RegioHelden版を経て現在の xmera-circle版へフォークされています。（[関連リンク](#関連リンク)）

## そもそもこの機能が必要になる背景

冒頭に書いた通り、「会社のセキュリティガイドラインに従わないといけないから」なのですが、それがなぜ必要かを紐解いてみると、ログイン試行を何度やってもアカウントがロックアウトしなければ、悪意ある攻撃者がそのサイトに何度でもログイン試行をできてしまうわけです。そうすると、総当たりや辞書アタックなどで容易にユーザ認証を突破されるアカウントがでてしまう可能性があり、セキュリティ的に脆弱な状態になってしまいます。

このような脆弱性に対処するために、最近のRedmineには標準で2FAを有効にすることができます。2FAが有効になっていれば、攻撃されたとしても、容易に認証を突破できないと考えられます。
しかし、ガイドラインというしろものは面倒なもので、本質的には2FAで解決できるとしても、「ログイン失敗を複数回繰り返すとアカウントロックするしくみを有すること」という項目の回答にはならないのです。（説明すれば通るかもしれないのですがｗ）

## 使い方

プラグインの設定画面で、ロックまでの試行回数、ブロックされる時間（分）、管理者にメールするかどうかを設定することができます。また、プラグインの設定画面でロックを解除することができます。ロックする動作は登録されたユーザIDのみで、登録されていないユーザに対してはロックはされません。
![LoginAttemptsLimit](/images/LoginAttemptsLimit.png)

詳細は xmera-circle のドキュメントをご確認ください。（[関連リンク](#関連リンク)）

## Redmine5や6で動くか？問題

結論。RedMica 3.2とRedmine 5.1の環境で試しましたがちゃんと動きました。（[試した環境](#試した環境)）

midnightSuyama版もRedmine6でちゃんと動きます。
midnightSuyama版は2021年12月が最後のコミットになっていて、さすがに古いのでダメかもとおもいましたが、ちゃんと動きます。

xmera-circle版ではgithubのReadmeではRedmine 5に対応していると明記されています。Redmine 6ではどうだろう、とおもいましたが、こちらもちゃんと動きました。（ただし、Advanced Plugin Helper に依存しており、これをインストールしてbundle installで追加のgemをいれる必要があります。）

整理すると、以下のような結果です。

| プラグイン | Redmine 5 | Redmine 6 | 備考 |
| --------- | --------- | --------- | ---- |
| midnightSuyama版 | 〇 | 〇 | 特になし |
| xmera-circle版 | 〇 | 〇 | Advanced Plugin Helper が必要 |

なぜかなり古いプラグインなのですが、新しいRedmineでも動くのは、DBを拡張せずにロック情報をRails.cacheにストアしているからのようです。
古くても動くならmidnightSuyama版でもよさそうですが、xmera-circle版では、以下の点でコードを改善しているとのことです（GPT5.1によると）

1. コード品質の向上
Rubocop 対応、モジュール化、命名改善など。
2. Redmine 5/6 の API に合わせた修正
古い Rails API の使用を排除し、互換性を確保。
3. テストコードの追加
ロック判定やキャッシュ処理のテストが追加されている。
4. Advanced Plugin Helper への統合
設定画面や構造が標準化され、保守性が向上。

## taikiiさんのプラグインについて

taikiiさんのプラグインも動作確認し、Redmine 6でも動作することを確認しました。「ログイン失敗を複数回繰り返すとアカウントロックするしくみを有すること」という要件だけであればOKです。しかし、このプラグインは、アカウントロック＝Redmineのユーザをロックステータスにする、という動きになります。
この動きだと、IDがわかっているユーザに対するログイン失敗を意図的に行うことで、（ご本人も書かれていますが）そのユーザを使えなくする、という攻撃ができてしまいます。このような攻撃のたびに管理者が手動で有効化しなければならないと、運用上の負担がかかってしまいます。
その点、Redmine Login Attempts Limitだと、ログイン失敗後、一定時間経過すると、ロック状態が解除されます。そのため、総当たりなどの攻撃をされても自動的にログイン可能状態に戻るため、運用負担なしに攻撃に対する耐性をもたせることができます。

## まとめ

「ログイン失敗を複数回繰り返すとアカウントロックするしくみを有すること」という観点では、Redmine Login Attempts LimitというプラグインがRedmine 6でも動作することが確認できました。現時点では、xmera-circle版のプラグインがおすすめできます。
なお、よりセキュリティを確保しなければならない場合は2FAを有効化する運用と併用することがよいとおもいます。
2FAまでいれると運用周知が面倒だけど、ある程度はセキュリティ対策もしたい、といった場合にこのプラグインを使ってみてはいかがでしょうか。

## 参考情報

### 関連リンク

- [Redmine Login Attempts Limit (xmera-circle版)](https://github.com/xmera-circle/redmine_login_attempts_limit)
- [ドキュメント（xmera-circle wiki）](https://circle.xmera.de/projects/redmine-login-attempts-limit/wiki)
- [midnightSuyama版](https://github.com/midnightSuyama/redmine_login_attempts_limit)
- [RegioHelden版](https://github.com/RegioHelden/redmine_login_attempts_limit)

### 試した環境

- RedMica 3.2.4.stable (based on Redmine 6.0.6.devel)
- Redmine 5.1.3.stable
